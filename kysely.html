<link rel="stylesheet" href="kysely.css" />
<meta charset="UTF-8">
<body>
<h1>Tyoaikakirjaus</h1>
<form method="POST" action="kysely.php" id="kysely">
    <h3>
        Yritysnimi<br>
        <input type="text" name="yritysNimi" required><br><br>
        Pääkäyttäjän Etunimi<br>
        <input type="text" name="etuNimi" required><br><br>
        Pääkäyttäjän Sukunimi<br>
        <input type="text" name="sukuNimi" required><br><br>
        Pääkäyttäjän Puhelinnumero<br>
        <input type="tel" name="puhelinNumero" required><br><br>
        Työaikakirjaus<br>

        <div class="Työaikakirjaus">
            <input type="checkbox" id="ajoBox" name="työAikaKirjaus[]" value="Ajo">
            <label>Ajo</label><br>
            <input type="checkbox" name="työAikaKirjaus[]" value="Lastaus">
            <label> Lastaus</label><br>
            <input type="checkbox" name="työAikaKirjaus[]" value="Purku">
            <label> Purku</label><br>
            <input type="checkbox" name="työAikaKirjaus[]" value="Odotus">
            <label> Odotus</label><br>
            <input type="checkbox" id="taukoBox" name="työAikaKirjaus[]" value="Tauko">
            <label> Tauko</label><br>
            <input type="checkbox" id="muuBox" name="työAikaKirjaus[]" value="Muu">
            <label> Muu työ</label><br>

            <div class="muuTextDiv" id="muuTextDiv">
                <input type="text" class="muuText" id="muuText1"name="muuText[]" placeholder="">
                <input type="text" class="muuText" name="muuText[]" placeholder="">
                <input type="text" class="muuText" name="muuText[]" placeholder="">
                <input type="text" class="muuText" name="muuText[]" placeholder="">
                <input type="text" class="muuText" name="muuText[]" placeholder="">
                <input type="text" class="muuText" name="muuText[]" placeholder="">
                <input type="text" class="muuText" name="muuText[]" placeholder="">
                <input type="text" class="muuText" name="muuText[]" placeholder="">
                <input type="text" class="muuText" name="muuText[]" placeholder="">
                <input type="text" class="muuText" name="muuText[]" placeholder="">
                <input type="text" class="muuText" name="muuText[]" placeholder="">
                <input type="text" class="muuText" name="muuText[]" placeholder="">
            </div>
            <div class="ajoDiv">
                Kun kuljettaja aloittaa ajon, kirjataanko teillä auton kilometrit ylös? <br>
                <div class="ajoRadioDiv" id="ajoRadioDiv">
                    <input type="radio" class="ajoRadio" name="ajoButton" value="Kyllä">
                    <label>Kyllä</label><br>
                    <input type="radio" class="ajoRadio" name="ajoButton" value="Ei">
                    <label>Ei</label><br>
                </div>
            </div>
            <br>
            <div class="taukoDiv">
                Onko tauko palkallinen?<br>
                <div class="taukoRadioDiv" id="taukoRadioDiv">
                    <input type="radio" class="taukoRadio" name="taukoButton" value="Kyllä">
                    <label>Kyllä</label><br>
                    <input type="radio" class="taukoRadio" name="taukoButton" value="Ei">
                    <label>Ei</label><br>
                    <input type="radio" class="taukoRadio" name="taukoButton" value="TES">
                    <label>TES:n mukainen</label><br>
                </div>
            </div>
            <br>
            Seuraavan palkkajakson aloitus- ja lopetuspäivä<br> 
            <input type="date" name="aloitusPaiva" required><br>
            <input type="date" name="lopetusPaiva" required><br>
            <br>
            <input type="submit" value="Tallenna">
        </div>
    </h3>
</form>
</body>

<script>

const taukoCheckbox = document.getElementById('taukoBox');
const taukoRadiosContainer = document.getElementById('taukoRadioDiv');
const ajoCheckbox = document.getElementById('ajoBox');
const ajoRadiosContainer = document.getElementById('ajoRadioDiv');
const muuCheckbox = document.getElementById('muuBox');
const muuTextContainer = document.getElementById('muuTextDiv');

taukoCheckbox.addEventListener('change', function() {
    if (!this.checked) {
        taukoRadiosContainer.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    }
});

ajoCheckbox.addEventListener('change', function() {
    if (!this.checked) {
        ajoRadiosContainer.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    }
});

muuCheckbox.addEventListener('change', function() {
    if (!this.checked) {
        muuTextContainer.querySelectorAll('input[type="text"]').forEach(input => {
        input.value = '';
            if (input.id !== 'muuText1') {
                input.style.display = 'none'; // hide all except the first
            }
            else {
             document.getElementById('muuText1').style.display = 'grid';
            }
        });

    }
});

    // Tyhjentää extra inputit jos aikaisempi poistetaan
document.querySelectorAll('.muuText').forEach((input, index, allInputs) => {
    input.addEventListener('input', () => {
        for (let i = index + 1; i < allInputs.length; i++) {
            const prev = allInputs[i - 1];
            const curr = allInputs[i];

            if (prev.value.trim() === "") {
                curr.value = ""; 
                curr.style.display = "none";
            } else {
                curr.style.display = "grid";
            }
        }
    });
});

    //tarkistaa, että jokin radio button on painettu
document.getElementById("kysely").addEventListener("submit", function(e) {

    const tRadios = document.querySelectorAll('input[name="taukoButton"]');

    const visible_tRadios = [...tRadios].filter(r => r.offsetParent !== null);

    if (visible_tRadios.length > 0) {
        const selected = [...tRadios].some(r => r.checked);


        if (!selected) {
            e.preventDefault();
            alert("Valitse tauko!");
            return;
        }
    }


});
    //tarkistaa, että jokin radio button on painettu
document.getElementById("kysely").addEventListener("submit", function(e) {

    const aRadios = document.querySelectorAll('input[name="ajoButton"]');

    const visible_aRadios = [...aRadios].filter(r => r.offsetParent !== null);

    if (visible_aRadios.length > 0) {
        const selected = [...aRadios].some(r => r.checked);


        if (!selected) {
            e.preventDefault();
            alert("Valitse Ajokirjaus!");
            return;
        }
    }


});
    //tarkistaa, että jokin check box on painettu
document.getElementById("kysely").addEventListener("submit", function(e) {
    const checkboxes = document.querySelectorAll('input[name="työAikaKirjaus[]"');
    
    const anyChecked = [...checkboxes].some(cb => cb.checked);

    if (!anyChecked) {
        e.preventDefault();
        alert("Valitse ainakin yksi työaikakirjaus!");
    }
});
</script>